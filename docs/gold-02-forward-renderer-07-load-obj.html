<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Chargement de modèles OBJ · OpenGL[&quot;noël&quot;]</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&gt; Vous pouvez obtenir différents modèles OBJ sur [cette page](https://casual-effects.com/data/) (je vous conseille de commencer par essayer avec Crytek-Sponza)."/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Chargement de modèles OBJ · OpenGL[&quot;noël&quot;]"/><meta property="og:type" content="website"/><meta property="og:url" content="https://celeborn2bealive.github.io/openglnoel/"/><meta property="og:description" content="&gt; Vous pouvez obtenir différents modèles OBJ sur [cette page](https://casual-effects.com/data/) (je vous conseille de commencer par essayer avec Crytek-Sponza)."/><meta property="og:image" content="https://celeborn2bealive.github.io/openglnoel/img/logo.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://celeborn2bealive.github.io/openglnoel/img/logo.png"/><link rel="shortcut icon" href="/openglnoel/img/favicon.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css"/><link rel="alternate" type="application/atom+xml" href="https://celeborn2bealive.github.io/openglnoel/blog/atom.xml" title="OpenGL[&quot;noël&quot;] Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://celeborn2bealive.github.io/openglnoel/blog/feed.xml" title="OpenGL[&quot;noël&quot;] Blog RSS Feed"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/openglnoel/js/code-block-buttons.js"></script><script type="text/javascript" src="/openglnoel/js/disqus.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="/openglnoel/js/scrollSpy.js"></script><link rel="stylesheet" href="/openglnoel/css/main.css"/><script src="/openglnoel/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/openglnoel/"><img class="logo" src="/openglnoel/img/logo.png" alt="OpenGL[&quot;noël&quot;]"/><h2 class="headerTitleWithLogo">OpenGL[&quot;noël&quot;]</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/openglnoel/docs/intro-sdk-01-philogl-01-introduction" target="_self">Introduction et SDK</a></li><li class=""><a href="/openglnoel/docs/bronze-02-hello-triangle-01-code-de-base" target="_self">Bronze</a></li><li class=""><a href="/openglnoel/docs/silver-01-3d-theorie-01-introduction" target="_self">Silver</a></li><li class="siteNavGroupActive"><a href="/openglnoel/docs/gold-01-intro-sdk-01-introduction" target="_self">Gold</a></li><li class=""><a href="/openglnoel/blog/" target="_self">Blog</a></li><li class=""><a href="http://docs.gl" target="_self">OpenGL Documentation</a></li><li class=""><a href="https://www.khronos.org/opengl/wiki/" target="_self">OpenGL Wiki</a></li><li class=""><a href="https://github.com/celeborn2bealive/openglnoel" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Forward Renderer</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Introduction et SDK</h3><ul class=""><li class="navListItem"><a class="navItem" href="/openglnoel/docs/gold-01-intro-sdk-01-introduction">Introduction</a></li><li class="navListItem"><a class="navItem" href="/openglnoel/docs/gold-01-intro-sdk-03-fiche-info">Fiche d&#x27;information</a></li><li class="navListItem"><a class="navItem" href="/openglnoel/docs/gold-01-intro-sdk-05-projet">Projet - Un viewer glTF</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Forward Renderer</h3><ul class=""><li class="navListItem"><a class="navItem" href="/openglnoel/docs/gold-02-forward-renderer-01-pipeline">Pipeline de Rendu</a></li><li class="navListItem"><a class="navItem" href="/openglnoel/docs/gold-02-forward-renderer-02-geometrie">Geometrie</a></li><li class="navListItem"><a class="navItem" href="/openglnoel/docs/gold-02-forward-renderer-03-shaders">Shaders</a></li><li class="navListItem"><a class="navItem" href="/openglnoel/docs/gold-02-forward-renderer-04-transformations">Transformations</a></li><li class="navListItem"><a class="navItem" href="/openglnoel/docs/gold-02-forward-renderer-05-lighting">Lighting</a></li><li class="navListItem"><a class="navItem" href="/openglnoel/docs/gold-02-forward-renderer-06-textures">Textures</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/openglnoel/docs/gold-02-forward-renderer-07-load-obj">Chargement de modèles OBJ</a></li><li class="navListItem"><a class="navItem" href="/openglnoel/docs/gold-02-forward-renderer-08-plus-loin">Aller plus loin</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Deferred Renderer</h3><ul class=""><li class="navListItem"><a class="navItem" href="/openglnoel/docs/gold-03-deferred-renderer-01-pipeline">Pipeline de Rendu</a></li><li class="navListItem"><a class="navItem" href="/openglnoel/docs/gold-03-deferred-renderer-02-geometry-pass">Geometrie Pass</a></li><li class="navListItem"><a class="navItem" href="/openglnoel/docs/gold-03-deferred-renderer-03-shading-pass">Shading Pass</a></li><li class="navListItem"><a class="navItem" href="/openglnoel/docs/gold-03-deferred-renderer-04-plus-loin">Aller plus loin</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Shadow Mapping</h3><ul class=""><li class="navListItem"><a class="navItem" href="/openglnoel/docs/gold-04-shadow-mapping-01-introduction">Introduction</a></li><li class="navListItem"><a class="navItem" href="/openglnoel/docs/gold-04-shadow-mapping-02-dir-shadow-map">Directional Shadow Map</a></li><li class="navListItem"><a class="navItem" href="/openglnoel/docs/gold-04-shadow-mapping-03-percentage-closest-filtering">Percentage Closest Filtering</a></li><li class="navListItem"><a class="navItem" href="/openglnoel/docs/gold-04-shadow-mapping-04-aller-plus-loin">Aller Plus Loin</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Post Processing</h3><ul class=""><li class="navListItem"><a class="navItem" href="/openglnoel/docs/gold-05-post-processing-01-introduction">Introduction</a></li><li class="navListItem"><a class="navItem" href="/openglnoel/docs/gold-05-post-processing-02-gamma-correction">Gamma Correction</a></li><li class="navListItem"><a class="navItem" href="/openglnoel/docs/gold-05-post-processing-03-extraction-contours">Extraction et Rendu de Contours</a></li><li class="navListItem"><a class="navItem" href="/openglnoel/docs/gold-05-post-processing-04-depth-of-field">Depth of Field</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Annexe: API OpenGL</h3><ul class=""><li class="navListItem"><a class="navItem" href="/openglnoel/docs/gold-06-course-01-opengl-context">Contexte OpenGL</a></li><li class="navListItem"><a class="navItem" href="/openglnoel/docs/gold-06-course-02-gpu-pipeline">Pipeline de Rendu</a></li><li class="navListItem"><a class="navItem" href="/openglnoel/docs/gold-06-course-03-opengl-extensions">Extensions OpenGL</a></li><li class="navListItem"><a class="navItem" href="/openglnoel/docs/gold-06-course-04-opengl-objects">Objets OpenGL</a></li><li class="navListItem"><a class="navItem" href="/openglnoel/docs/gold-06-course-05-buffer-objects">Buffer Objects</a></li><li class="navListItem"><a class="navItem" href="/openglnoel/docs/gold-06-course-06-vertex-array-objects">Vertex Array Objects</a></li><li class="navListItem"><a class="navItem" href="/openglnoel/docs/gold-06-course-07-textures">Texture Objects</a></li><li class="navListItem"><a class="navItem" href="/openglnoel/docs/gold-06-course-08-framebuffer-objects">Framebuffer Objects</a></li><li class="navListItem"><a class="navItem" href="/openglnoel/docs/gold-06-course-09-shaders">Shaders</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Chargement de modèles OBJ</h1></header><article><div><span><blockquote>
<p>Vous pouvez obtenir différents modèles OBJ sur <a href="https://casual-effects.com/data/">cette page</a> (je vous conseille de commencer par essayer avec Crytek-Sponza).</p>
</blockquote>
<blockquote>
<p><span class="badge warning"></span> Le 16/01/2019 - J'ai choisis d'ajouter tinyobjloader pour remplacer assimp sur les machines de l'université en raison des quotas d'espace disque faible. Assimp n'est donc plus compilé avec les scripts linux (j'ai choisis de le laisser sous windows). Le code source d'assimp est toujours présent dans le repository car c'est surtout la version compilée qui prend de la place. Pour récupérer les modifications du repository sur votre fork, commencez par restaurer le CMakeLists.txt dans son etat d'origine si il avait été modifié pour ne plus compiler Assimp. Ensute commitez et pushez tout votre code pour le sauvegarder. Enfin suivez <a href="/openglnoel/docs/intro-sdk-02-SDK-01-repository#recuperer-des-modification-sur-votre-fork-depuis-le-repo-original">cette procédure pour faire une <em>Pull Request</em></a>. Il faut merger les branches master et cheat-gold.</p>
</blockquote>
<h2><a class="anchor" aria-hidden="true" id="api"></a><a href="#api" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>API</h2>
<p>Utiliser la fonction suivante de la lib pour charger un modèle OBJ:</p>
<pre><code class="hljs css language-cpp"><span class="hljs-keyword">void</span> glmlv::loadObjScene(<span class="hljs-keyword">const</span> glmlv::fs::path &amp; objPath, glmlv::SceneData &amp; data);
</code></pre>
<p>Celle-ci charge le fichier dont le chemin est passé en paramètre (pensez à mettre le modèle dans le repertoire <em>assets</em>).
Elle remplit une structure de type <strong>glmlv::SceneData</strong> contenant les informations suivantes:</p>
<pre><code class="hljs css language-cpp"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">SceneData</span>
{</span>
    <span class="hljs-comment">// Points min et max de la bounding box englobant la scene</span>
    glm::vec3 bboxMin = glm::vec3(<span class="hljs-built_in">std</span>::numeric_limits&lt;<span class="hljs-keyword">float</span>&gt;::max());
    glm::vec3 bboxMax = glm::vec3(<span class="hljs-built_in">std</span>::numeric_limits&lt;<span class="hljs-keyword">float</span>&gt;::lowest());

    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;Vertex3f3f2f&gt; vertexBuffer; <span class="hljs-comment">// Tableau de sommets</span>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">uint32_t</span>&gt; indexBuffer; <span class="hljs-comment">// Tableau d'index de sommets</span>

    <span class="hljs-keyword">size_t</span> shapeCount = <span class="hljs-number">0</span>; <span class="hljs-comment">// Nombre d'objets à dessiner</span>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">uint32_t</span>&gt; indexCountPerShape; <span class="hljs-comment">// Nomber d'index de sommets pour chaque objet</span>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;glm::mat4&gt; localToWorldMatrixPerShape; <span class="hljs-comment">// Matrice localToWorld de chaque objet</span>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int32_t</span>&gt; materialIDPerShape; <span class="hljs-comment">// Index du materiau de chaque objet (-1 si pas de materiaux)</span>

    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;PhongMaterial&gt; materials; <span class="hljs-comment">// Tableau des materiaux</span>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;Image2DRGBA&gt; textures; <span class="hljs-comment">// Tableau des textures référencés par les materiaux</span>
}
</code></pre>
<p>Les tableaux vertexBuffer et indexBuffer doivent être utilisés pour remplir un VBO et un IBO à binder sur un VAO pour le rendu.</p>
<p>Les champs bboxMin et bboxMax permettent de connaitre les dimensions de la scene afin d'adapter la vitesse de la caméra et la matrice de projection. Par exemple:</p>
<pre><code class="hljs css language-cpp">SceneData data;
loadObjScene(path, data);

<span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> sceneDiagonalSize = glm::length(data.bboxMax - data.bboxMin);
m_viewController.setSpeed(sceneDiagonalSize * <span class="hljs-number">0.1f</span>); <span class="hljs-comment">// 10% de la scene parcouru par seconde</span>

<span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> projMatrix = glm::perspective(<span class="hljs-number">70.f</span>, <span class="hljs-keyword">float</span>(viewportSize.x) / viewportSize.y, <span class="hljs-number">0.01f</span> * m_SceneSize, m_SceneSize); <span class="hljs-comment">// near = 1% de la taille de la scene, far = 100%</span>
</code></pre>
<p>Le tableau indexCountPerShape doit être utilisé lors du rendu pour dessiner chacun des objets:</p>
<pre><code class="hljs css language-cpp">glBindVertexArray(m_SceneVAO);
<span class="hljs-keyword">auto</span> indexOffset = <span class="hljs-number">0</span>;
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> indexCount: indexCountPerShape)
{
    glDrawElements(GL_TRIANGLES, indexCount, GL_UNSIGNED_INT, (<span class="hljs-keyword">const</span> GLvoid*) (indexOffset * <span class="hljs-keyword">sizeof</span>(GLuint)));
    indexOffset += indexCount
}
</code></pre>
<p>Dans le code ci-dessus, l'index offset permet de dire à OpenGL ou se trouve les indices du i-ème objet dans le tableau d'indices.</p>
<p>Le tableau textures contient les textures référencées dans l'OBJ. Après chargement de l'OBJ, il faut créer une texture OpenGL pour chacune.</p>
<p>Le tableau materials contient l'ensemble des materiaux référencés dans la scène. La fonction loadAssimpScene ne charge que les données de matériaux nécessaires à un modèle de shading de Blinn-Phong (Ambiant + Diffus + Glossy).</p>
<p>Finalement, le tableau materialIDPerShape indique le materiau de chaque objet (l'index d'un élement du tableau materials).</p>
<p>A noter que si un objet n'a pas de matériau, -1 sera placé à sa position dans materialIDPerShape.
De la même manière, si un champs texture n'est pas renseigné pour un matériaux, alors il est mis à -1.</p>
<p>Il faut donc, après avoir appelé cette fonction, initialiser toutes les données GPU (un VBO, un IBO, un VAO, des textures object, un texture sampler, les uniform location, le programme GLSL) afin de pouvoir dessiner la scène dans la boucle de rendu.</p>
<p>Comme pour les exercices précédent, il est conseillé d'y aller par étape. D'abord afficher uniquement les normales des objets 3D, puis afficher la couleur diffuse, puis faire l'illumination.</p>
<h2><a class="anchor" aria-hidden="true" id="modele-de-shading"></a><a href="#modele-de-shading" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Modèle de Shading</h2>
<p>Améliorer le modèle de shading utilisé pour utiliser le modèle de Blinn-Phong plutot qu'un simple modèle Diffus (voir <a href="gold-02-forward-renderer-07-load-obj">cet ancien TD</a> pour les équations).</p>
<p>Cela implique de rajouter des variables uniformes pour le coefficient speculaire, la texture speculaire, l'exposant de shininess et la texture de shininess.</p>
<p>Vous pouvez également rajouter le terme ambiant en addition.</p>
<p>Toutes les informations necessaires sont chargées dans les matériaux de SceneData.</p>
<blockquote>
<p>Si vous bloquez sur un element du TP, vous pouvez puller la branche <em>cheat</em> du repo et regarder le code de l'application <em>forward-renderer-06-load-obj</em>.</p>
</blockquote>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/openglnoel/docs/gold-02-forward-renderer-06-textures"><span class="arrow-prev">← </span><span>Textures</span></a><a class="docs-next button" href="/openglnoel/docs/gold-02-forward-renderer-08-plus-loin"><span>Aller plus loin</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#api">API</a></li><li><a href="#modele-de-shading">Modèle de Shading</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/openglnoel/" class="nav-home"><img src="/openglnoel/img/logo.png" alt="OpenGL[&quot;noël&quot;]" width="66" height="58"/></a><div><h5>About Me</h5><a href="http://laurentnoel.fr">Personal website</a><a href="https://github.com/Celeborn2BeAlive/">Github</a></div><div><h5>About This Website</h5><a href="/openglnoel/blog">Blog</a><a class="github-button" href="https://github.com/celeborn2bealive/openglnoel" data-icon="octicon-star" data-count-href="/celeborn2bealive/openglnoel/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">openglnoel</a><a href="https://docusaurus.io/">Powered by Docusaurus</a></div><div><h5>About OpenGL</h5><a href="docs.gl">Documentation (docs.gl)</a><a href="https://www.khronos.org/opengl/wiki/">Wiki</a></div></section><section class="copyright">Copyright © 2019 Laurent NOEL</section></footer></div></body></html>