<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Dessiner un triangle en couleurs · OpenGL[&quot;noël&quot;]</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="L&#x27;objectif à présent est de dessiner un triangle en couleurs. Mais en OpenGL3, la couleur n&#x27;est pas gratuite: il faut utiliser des shaders. Nous verrons comment écrire et intéragir avec des shaders lors du prochain TP. Pour ce TP je vais vous fournir des shaders déja codés que vous chargerez en utilisant les classes fournies dans le template."/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Dessiner un triangle en couleurs · OpenGL[&quot;noël&quot;]"/><meta property="og:type" content="website"/><meta property="og:url" content="https://celeborn2bealive.github.io/openglnoel/"/><meta property="og:description" content="L&#x27;objectif à présent est de dessiner un triangle en couleurs. Mais en OpenGL3, la couleur n&#x27;est pas gratuite: il faut utiliser des shaders. Nous verrons comment écrire et intéragir avec des shaders lors du prochain TP. Pour ce TP je vais vous fournir des shaders déja codés que vous chargerez en utilisant les classes fournies dans le template."/><meta property="og:image" content="https://celeborn2bealive.github.io/openglnoel/img/logo.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://celeborn2bealive.github.io/openglnoel/img/logo.png"/><link rel="shortcut icon" href="/openglnoel/img/favicon.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css"/><link rel="alternate" type="application/atom+xml" href="https://celeborn2bealive.github.io/openglnoel/blog/atom.xml" title="OpenGL[&quot;noël&quot;] Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://celeborn2bealive.github.io/openglnoel/blog/feed.xml" title="OpenGL[&quot;noël&quot;] Blog RSS Feed"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/openglnoel/js/code-block-buttons.js"></script><script type="text/javascript" src="/openglnoel/js/disqus.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="/openglnoel/js/scrollSpy.js"></script><link rel="stylesheet" href="/openglnoel/css/main.css"/><script src="/openglnoel/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/openglnoel/"><img class="logo" src="/openglnoel/img/logo.png" alt="OpenGL[&quot;noël&quot;]"/><h2 class="headerTitleWithLogo">OpenGL[&quot;noël&quot;]</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/openglnoel/docs/intro-sdk-01-philogl-01-introduction" target="_self">Intro et SDK</a></li><li class="siteNavGroupActive"><a href="/openglnoel/docs/bronze-02-hello-triangle-01-code-de-base" target="_self">Bronze</a></li><li class=""><a href="/openglnoel/docs/silver-01-3d-theorie-01-introduction" target="_self">Silver</a></li><li class=""><a href="/openglnoel/docs/gold-01-intro-sdk-01-introduction" target="_self">Gold</a></li><li class=""><a href="/openglnoel/docs/gltf-viewer-01-intro-01-intro" target="_self">glTF Viewer Tutorial</a></li><li class=""><a href="/openglnoel/blog/" target="_self">Blog</a></li><li class=""><a href="http://docs.gl" target="_self">OpenGL Documentation</a></li><li class=""><a href="https://www.khronos.org/opengl/wiki/" target="_self">OpenGL Wiki</a></li><li class=""><a href="https://github.com/celeborn2bealive/openglnoel" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Hello Triangle</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Hello Triangle</h3><ul class=""><li class="navListItem"><a class="navItem" href="/openglnoel/docs/bronze-02-hello-triangle-01-code-de-base">Le code de base</a></li><li class="navListItem"><a class="navItem" href="/openglnoel/docs/bronze-02-hello-triangle-02-triangle-blanc">Dessiner un triangle blanc</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/openglnoel/docs/bronze-02-hello-triangle-03-triangle-couleurs">Dessiner un triangle en couleurs</a></li><li class="navListItem"><a class="navItem" href="/openglnoel/docs/bronze-02-hello-triangle-04-vertex-structure">Utiliser une structure de vertex</a></li><li class="navListItem"><a class="navItem" href="/openglnoel/docs/bronze-02-hello-triangle-05-dessiner-quad">Dessiner un quad</a></li><li class="navListItem"><a class="navItem" href="/openglnoel/docs/bronze-02-hello-triangle-06-dessiner-disque">Dessiner un disque</a></li><li class="navListItem"><a class="navItem" href="/openglnoel/docs/bronze-02-hello-triangle-07-index-buffers">Utiliser les buffers d&#x27;index</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Les shaders</h3><ul class=""><li class="navListItem"><a class="navItem" href="/openglnoel/docs/bronze-03-shaders-01-kesako">Shaders, kesako ?</a></li><li class="navListItem"><a class="navItem" href="/openglnoel/docs/bronze-03-shaders-02-exemple">Les shaders par l&#x27;exemple</a></li><li class="navListItem"><a class="navItem" href="/openglnoel/docs/bronze-03-shaders-03-compilation">Charger, compiler et utiliser</a></li><li class="navListItem"><a class="navItem" href="/openglnoel/docs/bronze-03-shaders-04-jouer">Jouer avec les shaders</a></li><li class="navListItem"><a class="navItem" href="/openglnoel/docs/bronze-03-shaders-05-mandelbrot">Mandelbrot</a></li><li class="navListItem"><a class="navItem" href="/openglnoel/docs/bronze-03-shaders-06-la-suite">Préparer la suite</a></li><li class="navListItem"><a class="navItem" href="/openglnoel/docs/bronze-03-shaders-07-triangle-tourne">Un triangle qui tourne</a></li><li class="navListItem"><a class="navItem" href="/openglnoel/docs/bronze-03-shaders-08-matrices">Envoyer des matrices</a></li><li class="navListItem"><a class="navItem" href="/openglnoel/docs/bronze-03-shaders-09-plusieurs-triangles">Plusieur triangles</a></li><li class="navListItem"><a class="navItem" href="/openglnoel/docs/bronze-03-shaders-10-textures">Textures</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Dessiner un triangle en couleurs</h1></header><article><div><span><p>L'objectif à présent est de dessiner un triangle en couleurs. Mais en OpenGL3, la couleur n'est pas gratuite: il faut utiliser des shaders. Nous verrons comment écrire et intéragir avec des shaders lors du prochain TP. Pour ce TP je vais vous fournir des shaders déja codés que vous chargerez en utilisant les classes fournies dans le template.</p>
<p><span class="badge todo"></span> Dans le répertoire TP1, dupliquez le fichier exo1_triangle_blanc.cpp et renommez le exo2_triangle_couleurs.cpp. Faite l'exercice dans ce dernier.</p>
<p><span class="badge todo"></span> Téléchargez les fichiers <a href="/openglnoel/docs/assets/triangle.vs.glsl">triangle.vs.glsl</a> et <a href="/openglnoel/docs/assets/triangle.fs.glsl">triangle.vs.glsl</a>. Placez les dans le repertoire shaders du TP1.</p>
<p><span class="badge todo"></span> Dans le fichier exo2_triangle_couleurs.cpp, ajoutez les include des fichier &lt;glimac/Program.hpp&gt; et &lt;glimac/FilePath.hpp&gt;. Dans le code de la fonction main, après l'initialisation de GLEW, ajoutez les lignes suivantes:</p>
<pre><code class="hljs css language-cpp"><span class="hljs-function">FilePath <span class="hljs-title">applicationPath</span><span class="hljs-params">(argv[<span class="hljs-number">0</span>])</span></span>;
Program program = loadProgram(applicationPath.dirPath() + <span class="hljs-string">"shaders/triangle.vs.glsl"</span>,
                              applicationPath.dirPath() + <span class="hljs-string">"shaders/triangle.fs.glsl"</span>);
program.use();
</code></pre>
<p>Ce code à pour effet de charger les shaders, les compiler (à l'execution de l'application) et d'indiquer à OpenGL de les utiliser.</p>
<p>Il faut maintenant modifier le code pour ajouter une couleur à chaque sommet. Faisons le par étape.</p>
<p>Modifier le tableau de sommets
Les couleurs sont gérés en OpenGL par des nombres flottants entre 0 et 1 (et non pas 0 et 255 comme dans la plupart des logiciels de dessin). Nous allons associer la couleur rouge \((1,0,0)\) au premier sommet, vert \((0,1,0)\) au deuxième sommet et bleu \((0,0,1)\) au troisième sommet.</p>
<p>Pour cela on modifie le tableau de sommet en rajoutant la couleur après chaque position:</p>
<pre><code class="hljs css language-cpp">GLfloat vertices[] = { <span class="hljs-number">-0.5f</span>, <span class="hljs-number">-0.5f</span>, <span class="hljs-number">1.f</span>, <span class="hljs-number">0.f</span>, <span class="hljs-number">0.f</span>, <span class="hljs-comment">// premier sommet</span>
<span class="hljs-number">0.5f</span>, <span class="hljs-number">-0.5f</span>, <span class="hljs-number">0.f</span>, <span class="hljs-number">1.f</span>, <span class="hljs-number">0.f</span>, <span class="hljs-comment">// deuxième sommet</span>
<span class="hljs-number">0.0f</span>, <span class="hljs-number">0.5f</span>, <span class="hljs-number">0.f</span>, <span class="hljs-number">0.f</span>, <span class="hljs-number">1.f</span> <span class="hljs-comment">// troisième sommet</span>
 };
</code></pre>
<p><img src="/openglnoel/img/vbo.svg" alt="VBO"></p>
<p>Il faut également modifier l'appel à glBufferData afin de mettre à jouer la taille du tableau qu'on lui envoit. Avant on lui passait 6 * sizeof(GLfloat), à présent c'est 15 * sizeof(GLfloat) (15 = le nombre de floats du tableau).</p>
<p>Activation et spécification des attributs de vertex
Puisqu'on rajoute l'attribut couleur, il faut modifier le spécifier. Il faut également modifier la spécification de l'attribut position car toute l'organisation du tableau de vertex à changé.</p>
<p>Connaitre l'index associé aux attributs
Comme mentionné précedemment, chaque attribut est identifié par un index. Dans l'exercice précédent, on n'utilisait pas de shader, et la position était identifié par l'index 0 (par défaut en OpenGL). A présent, on utilise des shaders. Pour connaitre l'index associé à chaque attribut, ouvrez le fichier triangle.vs.glsl que vous avez téléchargez. En début de fichier, vous devriez lire les lignes:</p>
<pre><code class="hljs css language-cpp">layout(location = <span class="hljs-number">3</span>) in vec2 aVertexPosition;
layout(location = <span class="hljs-number">8</span>) in vec3 aVertexColor;
</code></pre>
<p>Ces deux lignes déclarent les attributs de vertex du shader. la partie location = X indique l'index associé à chaque attribut. Notez bien que c'est moi qui ait choisit les index 3 et 8 dans ce cas. J'aurais très bien pu choisir d'autres nombres !</p>
<p><span class="badge todo"></span> En utilisant les index déclarés dans le fichier, modifiez votre code C++ de manière à activer les deux attributs de vertex position et couleur (rappel: avec la fonction glEnableVertexAttribArray). Vous devez normalement avoir deux appels à cette fonctions.</p>
<p>Spécifier les attributs de vertex
Il faut à présent modifier l'appel à glVertexAttribPointer pour l'attribut position et en rajouter un pour l'attribut couleur.</p>
<p>Voici un rappel de la signature de la fonction et des paramètres:</p>
<pre><code class="hljs css language-cpp">glVertexAttribPointer(GLuint index, 
    GLint size, GLenum type, GLboolean normalized, 
    GLsizei stride, <span class="hljs-keyword">const</span> GLvoid* pointer);
</code></pre>
<p>Paramètres:</p>
<ul>
<li>GLuint index: l'index de l'attribut à spécifier</li>
<li>GLint size: le nombre de composantes de l'attribut.</li>
<li>GLenum type: une constante OpenGL indiquant le type de chaque composante. Dans notre cas on passe GL_FLOAT pour indiquer que chaque composante est un nombre flottant.</li>
<li>GLboolean normalized: pas besoin de s'occuper de ce paramètre pour le moment, on passe GL_FALSE</li>
<li>GLsizei stride: indique à OpenGL le nombre d'octets séparant l'attribut pour deux sommets consécutifs.</li>
<li>const GLvoid* pointer: un pointeur, ou pas. Ce paramètre est un piège. Il faut en fait passer l'offset (décalage) en octets de la premiere instance de l'attribut dans le tableau.</li>
</ul>
<p>Ce schéma vous indique les paramètres à passer pour chaque attribut et comment les trouver:</p>
<p><img src="/openglnoel/img/vao.svg" alt="VAO"></p>
<p><span class="badge todo"></span> Modifier votre premier appel à glVertexAttribPointer pour spécifier l'attribut position correctement. Ajouter juste après un deuxième appel afin de spécifier l'attribut couleur. A noter qu'il faut caster le dernier paramètre (l'offset) en (const GLvoid*) afin d'éviter une erreur de compilation.</p>
<h2><a class="anchor" aria-hidden="true" id="tester-le-code"></a><a href="#tester-le-code" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Tester le code</h2>
<p>C'est terminé ! et oui c'était rapide par rapport à l'exercice précédent. Vous pouvez compiler et tester le code (n'oubliez pas de relancer CMake car le script se charge de copier-coller les shaders à coté de l'éxecutable compilé). Le résultat attendu est:</p>
<p><img src="/openglnoel/img/triangle.png" alt="Triangle couleurs"></p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/openglnoel/docs/bronze-02-hello-triangle-02-triangle-blanc"><span class="arrow-prev">← </span><span>Dessiner un triangle blanc</span></a><a class="docs-next button" href="/openglnoel/docs/bronze-02-hello-triangle-04-vertex-structure"><span>Utiliser une structure de vertex</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#tester-le-code">Tester le code</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/openglnoel/" class="nav-home"><img src="/openglnoel/img/logo.png" alt="OpenGL[&quot;noël&quot;]" width="66" height="58"/></a><div><h5>About Me</h5><a href="http://laurentnoel.fr">Personal website</a><a href="https://github.com/Celeborn2BeAlive/">Github</a></div><div><h5>About This Website</h5><a href="/openglnoel/blog">Blog</a><a class="github-button" href="https://github.com/celeborn2bealive/openglnoel" data-icon="octicon-star" data-count-href="/celeborn2bealive/openglnoel/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">openglnoel</a><a href="https://docusaurus.io/">Powered by Docusaurus</a></div><div><h5>About OpenGL</h5><a href="docs.gl">Documentation (docs.gl)</a><a href="https://www.khronos.org/opengl/wiki/">Wiki</a></div></section><section class="copyright">Copyright © 2020 Laurent NOEL</section></footer></div></body></html>